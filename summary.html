<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏ì‡∏∞‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</title>
  <link rel="stylesheet" href="styles/summary.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <header>
    <h1>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏ì‡∏∞‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h1>
  </header>

  <main>
    <div id="winnerBox" class="winner-box"></div>

    <table id="summaryTable">
      <thead>
        <tr>
          <th>‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</th>
          <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <footer>
    <p>¬© ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏ï‡∏£‡∏µ‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå | <a href="report.html">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</a></p>
  </footer>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDwmeumgDSVlspe7gIcF6rVbe-hBye7Q3I",
    authDomain: "school-scores-8e9eb.firebaseapp.com",
    databaseURL: "https://school-scores-8e9eb-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "school-scores-8e9eb",
    storageBucket: "school-scores-8e9eb.firebasestorage.app",
    messagingSenderId: "416720346956",
    appId: "1:416720346956:web:b20e84af0b635b374279e9",
    measurementId: "G-DD7E1RFNC1"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const FACULTIES = ["‡∏°‡∏≤‡∏•‡∏±‡∏¢‡∏û‡∏¥‡∏£‡∏∏‡∏ì","‡πÑ‡∏û‡∏à‡∏¥‡∏ï‡πÄ‡∏ß‡∏´‡∏≤‡∏™","‡πÇ‡∏≠‡∏†‡∏≤‡∏™‡∏£‡∏ß‡∏µ","‡∏à‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏≠‡∏≥‡πÑ‡∏û","‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏î‡∏≤‡∏£‡∏≤"];

  const CLASSROOMS = {
    "‡∏°‡∏≤‡∏•‡∏±‡∏¢‡∏û‡∏¥‡∏£‡∏∏‡∏ì": ["1/4","1/9","2/5","2/10","3/1","3/6","3/11","4/1","4/6","4/11","5/2","5/12","6/2","6/7","6/12"],
    "‡πÑ‡∏û‡∏à‡∏¥‡∏ï‡πÄ‡∏ß‡∏´‡∏≤‡∏™": ["1/5","1/10","2/1","2/6","2/11","3/2","3/7","3/12","4/2","4/12","5/3","5/8","6/3","6/8","6/11"],
    "‡πÇ‡∏≠‡∏†‡∏≤‡∏™‡∏£‡∏ß‡∏µ": ["1/1","1/6","1/11","2/2","2/7","3/3","3/8","4/3","4/8","4/13","5/4","5/9","5/11","6/4","6/9"],
    "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏≠‡∏≥‡πÑ‡∏û": ["1/3","1/8","1/13","2/4","2/9","3/5","3/10","4/5","4/7","4/10","5/1","5/6","6/5","6/6","6/13"],
    "‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏î‡∏≤‡∏£‡∏≤": ["1/2","1/7","1/12","2/3","2/8","2/13","3/4","3/9","4/4","4/9","5/5","5/7","5/10","5/13","6/1","6/10"]
  };

  const TYPE_LATE = "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏°‡∏≤‡∏™‡∏≤‡∏¢";
  const TYPE_LINEUP = "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ñ‡∏ß";
  const TYPE_CLEAN = "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î";
  const LATE_RANK_SCORES = [9, 8, 7, 6, 5];

  // =========================================================
  // ‚úÖ [‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà] ‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÅ‡∏ö‡∏ö "‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå 00:00"
  // ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô -> ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ history + ‡∏•‡πâ‡∏≤‡∏á scores
  // =========================================================

  // ‡∏´‡∏≤ timestamp ‡∏Ç‡∏≠‡∏á "‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå 00:00" ‡∏Ç‡∏≠‡∏á‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ï‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ)
  function getSundayStartMs(now = new Date()) {
    const d = new Date(now);
    const day = d.getDay(); // 0 = ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå
    d.setDate(d.getDate() - day);
    d.setHours(0, 0, 0, 0);
    return d.getTime();
  }

  // ‡∏ó‡∏≥ key ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö history (‡∏Å‡∏±‡∏ô‡∏ä‡∏ô‡∏Å‡∏±‡∏ô)
  function makeHistoryKey() {
    const pad = (n) => String(n).padStart(2, "0");
    const d = new Date();
    // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: 2026-01-14_18-20-59 (‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢‡∏ï‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}_${pad(d.getHours())}-${pad(d.getMinutes())}-${pad(d.getSeconds())}`;
  }

  async function weeklyResetIfNeeded() {
    const currentWeekStart = getSundayStartMs();

    const weekStartRef = db.ref("meta/weekStart");

    // ‚úÖ ‡πÉ‡∏ä‡πâ transaction ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡∏ã‡πâ‡∏≥
    const tx = await weekStartRef.transaction((saved) => {
      // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ -> ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏•‡∏¢ (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
      if (!saved) return currentWeekStart;

      // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÄ‡∏î‡∏¥‡∏° -> ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£ (‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°)
      if (saved === currentWeekStart) return;

      // ‡∏ñ‡πâ‡∏≤‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô -> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà (‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ß‡πà‡∏≤ "‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå")
      return currentWeekStart;
    });

    // ‡∏ñ‡πâ‡∏≤ transaction ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πà‡∏ô offline) ‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
    if (!tx.committed) return;

    const previousWeekStart = tx.snapshot.val();
    // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: tx.snapshot.val() ‡∏´‡∏•‡∏±‡∏á committed ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô "‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô" ‡πÅ‡∏•‡πâ‡∏ß
    // ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏ä‡πá‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏≠‡∏µ‡∏Å‡πÅ‡∏ö‡∏ö: ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ô DB ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö currentWeekStart ‡∏à‡∏∂‡∏á‡∏Ñ‡πà‡∏≠‡∏¢‡∏£‡∏µ
    // ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ localStorage ‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏ã‡πâ‡∏≥‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
    const localKey = "lastWeekStartSeen";
    const lastSeen = Number(localStorage.getItem(localKey) || 0);

    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏´‡πá‡∏ô weekStart ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß -> ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏µ‡∏≠‡∏µ‡∏Å
    if (lastSeen === currentWeekStart) return;

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï lastSeen ‡∏Å‡πà‡∏≠‡∏ô (‡∏Å‡∏±‡∏ô‡∏£‡∏µ‡∏ã‡πâ‡∏≥‡∏ñ‡πâ‡∏≤‡πÄ‡∏ô‡πá‡∏ï‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡∏Å)
    localStorage.setItem(localKey, String(currentWeekStart));

    // ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡πà‡∏≤‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô DB ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå
    const confirmSnap = await weekStartRef.get();
    const confirmVal = confirmSnap.val();

    // ‡∏ñ‡πâ‡∏≤ confirmVal ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤ weekStart ‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß
    // ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏£‡∏µ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà "‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏£‡∏¥‡∏á"
    // ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏ä‡πá‡∏Å: ‡∏î‡∏π flag ‡πÉ‡∏ô meta/lastResetAt ‡∏ß‡πà‡∏≤‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
    const resetFlagRef = db.ref("meta/lastResetWeekStart");
    const flagSnap = await resetFlagRef.get();
    const lastResetWeekStart = flagSnap.val();

    if (lastResetWeekStart === currentWeekStart) {
      // ‡∏°‡∏µ‡∏Ñ‡∏ô‡∏£‡∏µ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ
      return;
    }

    // ‚úÖ ‡∏î‡∏∂‡∏á scores ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡πâ‡∏≤‡∏á
    const scoresSnap = await db.ref("scores").get();
    const scoresData = scoresSnap.val() || {};

    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≠‡∏¢‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ history (‡∏ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡∏Å‡πá‡πÅ‡∏Ñ‡πà‡∏•‡πâ‡∏≤‡∏á/‡∏ï‡∏±‡πâ‡∏á flag)
    const historyKey = makeHistoryKey();
    await db.ref(`scores_history/${historyKey}`).set({
      weekStart: currentWeekStart,
      movedAt: Date.now(),
      scores: scoresData
    });

    // ‚úÖ ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÉ‡∏´‡∏°‡πà
    await db.ref("scores").remove();

    // ‚úÖ ‡∏ï‡∏±‡πâ‡∏á flag ‡∏ß‡πà‡∏≤‡∏£‡∏µ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß (‡∏Å‡∏±‡∏ô‡∏£‡∏µ‡∏ã‡πâ‡∏≥‡πÅ‡∏°‡πâ‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)
    await resetFlagRef.set(currentWeekStart);

    // (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö) ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏π‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏£‡∏µ‡πÅ‡∏•‡πâ‡∏ß
    console.log("‚úÖ ‡∏£‡∏µ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå 00:00)");
  }

  // =========================================================
  // ‚úÖ [‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà] ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ summary
  // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà "‡∏Å‡πà‡∏≠‡∏ô" db.ref('scores').on(...)
  // =========================================================
  weeklyResetIfNeeded().catch(err => console.error("weeklyResetIfNeeded error:", err));

  // =========================================================
  // üîª ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°
  // =========================================================
  db.ref("scores").on("value", (snapshot) => {
    const data = snapshot.val() || {};

    const totals = {};
    const lateCounts = {};
    const lateHasData = {};
    const lineupTotals = {};
    const cleanTotals = {};

    FACULTIES.forEach(f => {
      totals[f] = 0;
      lateCounts[f] = 0;
      lateHasData[f] = false;
      lineupTotals[f] = 0;
      cleanTotals[f] = 0;
    });

    for (const key in data) {
      const item = data[key] || {};
      const faculty = (item.faculty || "").trim();
      if (!FACULTIES.includes(faculty)) continue;

      const val = Number(item.value) || 0;

      if (item.type === TYPE_LATE) {
        lateCounts[faculty] += val;
        lateHasData[faculty] = true;
      } else if (item.type === TYPE_LINEUP) {
        lineupTotals[faculty] += val;
      } else if (item.type === TYPE_CLEAN) {
        cleanTotals[faculty] += val;
      }
    }

    // ‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ñ‡∏ß + ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡πâ‡∏≠‡∏á
    FACULTIES.forEach(f => {
      totals[f] += lineupTotals[f];
      const roomCount = CLASSROOMS[f]?.length || 0;
      totals[f] += roomCount > 0 ? (cleanTotals[f] / roomCount) : 0;
    });

    // ‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏°‡∏≤‡∏™‡∏≤‡∏¢: ‡∏Ñ‡∏ì‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• => Infinity (‡πÑ‡∏õ‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î)
    const sortedByLate = FACULTIES
      .map(f => [f, lateHasData[f] ? lateCounts[f] : Number.POSITIVE_INFINITY])
      .sort((a, b) => a[1] - b[1]);

// ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡∏≤‡∏¢‡πÄ‡∏•‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ -> ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏à‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏°‡∏≤‡∏™‡∏≤‡∏¢
const hasAnyLateData = FACULTIES.some(f => lateHasData[f] === true);

if (hasAnyLateData) {
  // ‡πÅ‡∏à‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏°‡∏≤‡∏™‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö (‡∏ô‡πâ‡∏≠‡∏¢‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤)
  sortedByLate.forEach(([f], idx) => {
    const lateScore = LATE_RANK_SCORES[Math.min(idx, LATE_RANK_SCORES.length - 1)];
    totals[f] += lateScore;
  });
} else {
  // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏°‡∏≤‡∏™‡∏≤‡∏¢ -> ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏°‡∏≤‡∏™‡∏≤‡∏¢ = 0 ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ì‡∏∞ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô "‡πÑ‡∏°‡πà‡∏£‡∏µ")
  // totals ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏ß‡∏Å‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°
}


    // ‡∏´‡∏≤ winner
    let winner = null;
    let maxScore = -Infinity;
    FACULTIES.forEach(f => {
      if (totals[f] > maxScore) {
        maxScore = totals[f];
        winner = f;
      }
    });

    const winnerBox = document.getElementById("winnerBox");
    if (winner && isFinite(maxScore)) {
      winnerBox.innerHTML = `üèÜ <strong>${winner}</strong> ‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ì‡∏∞‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° ${maxScore.toFixed(2)} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
    } else {
      winnerBox.innerHTML = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ";
    }

    // ‡πÄ‡∏ï‡∏¥‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    const tbody = document.querySelector("#summaryTable tbody");
    tbody.innerHTML = "";
    FACULTIES.forEach(f => {
      const row = document.createElement("tr");
      row.innerHTML = `<td>${f}</td><td>${(totals[f] || 0).toFixed(2)}</td>`;
      tbody.appendChild(row);
    });
  });
</script>

</body>
</html>
